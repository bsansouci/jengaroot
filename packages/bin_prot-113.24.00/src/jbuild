(library
 ((name bin_prot)
  (public_release ((status (build_and_install_as bin_prot))
                   (extra_deps (bigarray))))
  (c_names (blit_stubs float_stubs))
  (preprocessor_deps (int_codes.mlh config.h))
  (preprocess (((command "${CPP} -undef") (List (size write read type_class)))))))

(rule
 ((targets (config.h))
  (deps (detect-arch.sh test.c))
  (action "./${<} ${OCAMLC} config.h")))
